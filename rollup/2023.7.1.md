#zkSync 的技术架构
###1. zk rollup 架构
zkSync是基于ZK rollup架构的 L2 协议。ZK rollup 是一个更大的“rollup”家族的一种。

所有资金都由主链上的智能合约持有，而计算和存储则在链下进行。主要思想是，不是单独验证每个交易，而是将交易“汇总”到单个项目（汇总块），然后对其进行验证，同时批准所有交易。

####他的工作机制如下：
用户签署交易并将其提交给验证者。
验证者将数千笔交易汇总在一个区块中，并向主网上的智能合约提交新状态的加密承诺（根哈希）以及该新状态确实是该新状态的结果的加密证明（SNARK）将一些正确的事务应用于旧状态。
除了证明之外，状态 ∆（每笔交易的少量数据）在主链网络上以便宜的价格发布calldata。这使任何人都可以随时重建状态。

证明和状态 ∆ 由智能合约验证，从而验证区块中包含的所有交易的有效性和区块数据的可用性。
SNARK 验证比单独验证每笔交易要便宜得多，并且将状态存储在链下比将其存储在 EVM 上要便宜得多。因此，可以极大地提高可扩展性（约 100-200 倍主网容量）并节省交易成本。

####zkRollup 架构提供以下保证：
验证者永远不会破坏状态或窃取资金（与侧链不同）。
即使验证者停止合作，用户也可以随时从 zkRollup 智能合约中检索资金，因为数据是可用的（与 Plasma 不同）。
用户和单个受信任的第三方都不需要在线来监控 zkRollup 块以防止欺诈（与防欺诈系统不同，例如支付渠道或 Optimistic Rollups）。
也就是说，zkRollup 严格继承了底层 L1 的安全保证。

###2. 很大的吞吐量
自2021 年 2 月 9 日升级以来这为主网上的zkSync带来了递归支持，协议吞吐量基本上只受到需要通过以太坊发布每笔交易的状态更改calldata以确保数据可用性的限制。在当前 12.5M 的区块 Gas 限制下，zkSync 可以处理超过 2000 TPS。

###3. 交易结束
一旦zkSync块的 SNARK 证明生成并被智能合约接受， zkSync 中的交易就达到了以太坊的最终确定性。证明时间生成预计为 10 分钟左右，即提交后 10 分钟，zkSync（证明）交易与包含在同一个以太坊区块中的任何 L1 以太坊交易与有证明的交易一样是最终的。目前，当用户发送交易时，我们等待块被填充，因此我们不会立即生成证明。随着 zkSync 系统的更高吞吐量，块之间的时间将会减少。

相比之下，基于欺诈的扩展解决方案（例如乐观汇总）需要至少 2 周的锁定期才能或多或少地安全运行，这导致 2 周的目标* tx 最终确定时间。

应该补充的是，Matter Labs 和其他零知识证明 (ZKP) 领域的公司正在不断努力提高证明者的效率，这将导致更短的最终确定时间（可能降至 1 分钟以下）。

*对于自己验证每个 tx 的乐观汇总用户来说，主观确定时间可能会更短，但这会破坏乐观汇总作为扩展解决方案的目的。

###4.即时确认
尽管完成时间约为 10 分钟，但它不会影响网络的可用性。用户提交给zkSync的交易即时确认，即时在 UI 和 API 中显示给接收方（尽管它们被标记为未确认），并且转移的资产可以立即用于进一步转移（甚至可能最终在相同的 zkSync块）。

目前，即时确认纯粹是zkSync验证者承诺将交易包含在下一个区块中。不信任验证者的用户应等待完全确定，然后再考虑收到资产。

未来，验证者将向 zkSync添加安全债券。这将提供即时的经济确定性保证。它将按如下方式工作。

被选为参与zkSync区块生产的验证者必须向主网上的zkSync智能合约发布重要的安全保证金。验证者运行的共识向用户提供了一个亚秒级的确认，即他们的交易将被包含在下一个zkSync块中，由绝大多数（超过）2/3 的共识参与者（按权益加权）签署。

如果一个新的zkSync块被生成并提交到主链，它就不能被还原。但是，如果它不包含承诺的交易，则原始收据的签名者和新区块的签名者的交集的保证金将被削减。这个交叉点保证有超过 1/3 的股份。这保证了至少 1/3 的安全保证金可以被削减，并且只有恶意的验证者才会受到惩罚。

部分削减的资金将用于补偿 tx 接收者。其余的将被烧毁。

###5.解决主网拥堵
周期性的异常事件会导致以太坊网络出现非常严重的拥塞（著名的例子是 Cryptokitties 危机 和上海DOS攻击）。在这样的高峰期，gas 价格飞涨，移动加密资产可能会变得非常昂贵，导致某些服务无法运行或阻止套利机会。

此外，某些系统通常会在极端情况下发生故障，导致级联故障（最近的 DeFi 黑色星期四是一个很好的例子）。这对于基于防欺诈的扩展解决方案（支付渠道、乐观汇总）来说尤其令人担忧，因为如果在高流量期间发生攻击，他们的自动化安全机器人可能无法挖掘其防欺诈交易。拥塞，从而危及此类系统控制下的所有资产的安全。是什么让这些系统的问题变得更糟，在情况发生之前你永远无法知道，就像它发生了一样对于 Maker 的清算机器人。

相比之下，zkSync的定位非常好，可以在高拥塞环境中茁壮成长。

首先，拥塞的网络（就像有针对性的 DOS 攻击一样）永远不会对zkSync中的资产造成任何威胁。任何资金在zkSync内部或外部的移动都需要零知识证明的有效性，并且不受 L1 审查的任何影响。

其次，zkSync的正常运行也不太可能被中断，即使是较小的数量。验证者的节点被配置为自动将 gas 价格提高到高于平均水平，以获取具有高优先级的zkSync块。由于每笔交易的成本约为 L1 上相应普通交易成本的 1/100，因此 zkSync用户受到的影响最小。